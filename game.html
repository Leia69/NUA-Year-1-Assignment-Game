<!doctype html> 
<html lang="en"> 
<head> 
    <meta charset="UTF-8" />
    <title>JavaScript Demo</title>
    <script src="phaser.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>

<script type="text/javascript">

    var config = {
        type: Phaser.AUTO,
        width: 800,
        height: 600,
        physics: {
            default: 'arcade',
            arcade: {
                gravity: { y: 300 },
                debug: false
            }
        },
        scene: {
            preload: preload,
            create: create,
            update: update
        }
    };

    var player;
    var blocks;
    var animIndicator;
    var score = 0;
    var goombas = [];// on goombas
    const baseScale = 28;

    var game = new Phaser.Game(config);

    function preload ()
    {
        this.load.image('background', 'assets/background.png');
        this.load.image('brick', 'assets/block_brick.png');
        this.load.image('solidBrick', 'assets/block_solidBrick.png');
        this.load.image('shinyBrick', 'assets/block_shinyBrick.png');
        this.load.image('crackedBrick', 'assets/block_crackedBrick.png');
        this.load.image('questionMark', 'assets/block_questionMark.png');
        this.load.spritesheet('mario', 'assets/marioSSFixed.png', { frameWidth: 28, frameHeight: 28 });
        this.load.spritesheet('goomba', 'assets/goombaSS.png', {frameWidth: 18, frameHeight: 15});
    }

    function create ()
    {
        const gameScale = {width: (config.width/800)*baseScale, height: (config.height/600)*baseScale};
        this.add.image(400, 300, 'background');

        blocks = this.physics.add.staticGroup();

        for(let i = 0; i*gameScale.width < 800; i++){
            blocks.create(gameScale.width*i+(gameScale.width/2), 586, 'brick');
            blocks.create(gameScale.width*i+(gameScale.width/2), 572, 'brick');
        };
        for(let i = 15; i*gameScale.width < 800; i++ ){
            blocks.create(gameScale.width*i+(gameScale.width/2), config.height/1.4, 'brick');
        }
        for(let i = 0; i*gameScale.width < 800-(gameScale.width*15); i++ ){
            blocks.create(gameScale.width*i+(gameScale.width/2), config.height/2, 'brick');
        }
        for(let i = 15; i*gameScale.width < 800; i++ ){
            blocks.create(gameScale.width*i+(gameScale.width/2), config.height/4, 'brick');
        }
        player = this.physics.add.sprite(100, 450, 'mario');
        player.setCollideWorldBounds(true);
        goombas = this.physics.add.sprite(750, 50, 'goomba');
        goombas.setCollideWorldBounds(true);

        function Goomba(){
            this.pos = {x: 750, y: 50};
            this.dir = 0;
            this.dead = false;
            
        }
        for(let i = -1; i < goombas.length; i++){
            goombas.push(new Goomba());
        }

        this.anims.create({
            key: 'left',
            frames: this.anims.generateFrameNumbers('mario', { start: 1, end: 3 }),
            frameRate: 10,
            repeat: -1
        });

        this.anims.create({
            key: 'leftTurn',
            frames: [ { key: 'mario', frame: 0 } ],
            frameRate: 20
        });

        this.anims.create({
            key: 'rightTurn',
            frames: [ { key: 'mario', frame: 8 } ],
            frameRate: 20
        })

        this.anims.create({
            key: 'right',
            frames: this.anims.generateFrameNumbers('mario', { start: 5, end: 7 }),
            frameRate: 10,
            repeat: -1
        })

        this.anims.create({
            key:'goombawalk',
            frames: this.anims.generateFrameNumbers('goomba', { start: 0, end: 1}),
            framerate: 5,
            repeat: -1
        })


        cursors = this.input.keyboard.createCursorKeys();

        this.physics.add.collider(player, blocks);
        this.physics.add.collider(goombas, blocks);
        this.physics.add.collider(goombas, player);
    }

    function update ()
    {
        if(animIndicator == 1 && !cursors.left.isDown){
            animIndicator = 0;
            player.anims.play('leftTurn', true);
        }
        else if (animIndicator == 2 && !cursors.right.isDown){
            animIndicator = 0;
            player.anims.play('rightTurn', true);
        }
        if (cursors.left.isDown)
        {
            player.setVelocityX(-160);

            player.anims.play('left', true);
            animIndicator = 1;
        }
        
        else if (cursors.right.isDown)
        {
            player.setVelocityX(160);

            player.anims.play('right', true);
            animIndicator = 2;
        }
        else{
            player.setVelocityX(0);
        }
        if (cursors.up.isDown && player.body.touching.down)
        {
            player.setVelocityY(-330);
        }
        for(let i = 0; i < goombas.length; i++){
            if(!goombas[i].dead){
                if(goombas[i].dir == 0){
                    goombas[i].setVelocityX(-160);
                }
                else{
                    goombas[i].velocityX(160);
                }
                
            }

        }

    }

</script>

</body>
</html>